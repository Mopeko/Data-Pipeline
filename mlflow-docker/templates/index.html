<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>C'est pas l'iris ? — Prototype</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=ABeeZee&family=Cinzel:wght@400;700&family=Orbitron:wght@400;700;900&family=Barriecito&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/styles.css">
  </head>

<body>
<main class="page">
  <h1 class="brand">C’est pas l’iris ?</h1>

  <section class="stage">
    <div class="image-wrap">
      <img class="iris"
           src="https://www.figma.com/api/mcp/asset/de819370-e81a-4496-9c3f-46d11bbef112"
           alt="iris" />
    </div>

    <!-- FORM -->
    <form action="/predict" method="POST" class="card" id="predictForm" role="region">

      <!-- SPECIES -->
      <label class="label">Espèce de l'iris</label>
      <div class="select" id="speciesSelect" tabindex="0">
        <span class="select-value">Setosa</span>
        <img src="https://www.figma.com/api/mcp/asset/72e896e5-6e84-416e-865b-16fe20472ffe"
             class="select-arrow" />

        <input type="hidden" name="species" id="speciesHiddenInput" value="setosa">

        <ul class="options">
          <li class="option" data-value="setosa">Setosa</li>
          <li class="option" data-value="versicolor">Versicolor</li>
          <li class="option" data-value="virginica">Virginica</li>
        </ul>
      </div>

      <!-- WIDTH -->
      <label class="label">Largeur du sépale</label>
      <div class="row">
        <input type="number" step="0.1" name="sepal_width"
               class="input" placeholder="exemple 2.5" />
        <div class="unit">cm</div>
      </div>

      <!-- ✅ TOGGLE MODELE -->
      <label class="label">Choix du modèle</label>

      <div class="toggle-row">
        <span>Modèle avec espèces</span>

        <label class="switch">
          <input type="checkbox" id="modelToggle">
          <span class="slider"></span>
        </label>

        <span>Modèle sans espèces</span>
      </div>

      <!-- champ caché pour info backend -->
      <input type="hidden" name="api_target" id="apiTarget" value="predict">

      <!-- SUBMIT -->
      <button type="submit" class="predict-btn">Prédire</button>

      <!-- RESULT -->
      <label class="label">(Résultat)</label>
      <div class="row">
        <input class="input input-result"
               placeholder="En attente..."
               value="{{ prediction_text if prediction_text else '' }}"
               readonly />
        <div class="unit">cm</div>
      </div>

    </form>
  </section>
</main>

<script>
/* =====================
   SELECT CUSTOM
===================== */
(function(){
  const select = document.getElementById('speciesSelect');
  if (!select) return;

  const valueEl = select.querySelector('.select-value');
  const hiddenInput = document.getElementById('speciesHiddenInput');
  const options = select.querySelectorAll('.option');

  select.addEventListener('click', () => {
    select.classList.toggle('open');
  });

  options.forEach(opt => {
    opt.addEventListener('click', () => {
      valueEl.textContent = opt.textContent.trim();
      hiddenInput.value = opt.dataset.value;
      select.classList.remove('open');
    });
  });

  document.addEventListener('click', (e)=>{
    if (!select.contains(e.target)) {
      select.classList.remove('open');
    }
  });
})();

const toggle = document.getElementById("modelToggle");
const form = document.getElementById("predictForm");
const apiTarget = document.getElementById("apiTarget");

toggle.addEventListener("change", () => {
  if (toggle.checked) {
    form.action = "/predict_alt";
    apiTarget.value = "predict_alt";
  } else {
    form.action = "/predict";
    apiTarget.value = "predict";
  }
});
</script>

</body>
</html>
