<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>C'est pas l'iris ? — Prototype</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=ABeeZee&family=Barriecito&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050505;
      --card-bg: rgba(255, 255, 255, 0.04);
      --muted: rgba(255, 255, 255, 0.5);
      --glass-border: rgba(255, 255, 255, 0.08);
      --ai-accent: #00ffcc;
      --brand-gradient: linear-gradient(135deg, #FF00FF, #FF6600, #00FF00);
    }

    @keyframes glow {
      0%, 100% { text-shadow: 0 0 10px rgba(78, 253, 96, 0.3), 0 0 20px rgba(0, 255, 204, 0.1); }
      50% { text-shadow: 0 0 20px rgba(0, 255, 204, 0.6), 0 0 40px rgba(0, 255, 204, 0.3); }
    }

    * { box-sizing: border-box; }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: #fff;
      font-family: 'ABeeZee', Arial, sans-serif;
      overflow: hidden;
    }

    .page {
      display: flex;
      flex-direction: column;
      height: 100vh;
      position: relative;
    }

    .brand {
      font-family: 'Barriecito', cursive;
      font-size: clamp(30px, 6vw, 100px);
      letter-spacing: 20px;
      text-align: center;
      margin: 40px 0;
      z-index: 10;
      text-transform: uppercase;
      animation: glow 3s ease-in-out infinite;
    }

    .stage {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    .image-wrap {
      position: absolute;
      right: -5%; bottom: -5%;
      width: 85vw; height: 85vh;
      z-index: 1;
      pointer-events: none; 
    }

    .image-wrap .iris {
      width: 100%; height: 100%;
      object-fit: contain;
      opacity: 0.7;
      filter: saturate(1.2) contrast(1.1) brightness(1.3);
      clip-path: inset(30px 0 0 0);
    }

    .card {
      position: relative;
      z-index: 10;
      width: 420px;
      padding: 40px;
      background: var(--card-bg);
      backdrop-filter: blur(25px);
      -webkit-backdrop-filter: blur(25px);
      border-radius: 28px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    /* Animation pour masquer le menu espèce */
    .species-group {
      display: flex;
      flex-direction: column;
      gap: 18px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      max-height: 200px;
      opacity: 1;
      transform: translateY(0);
      overflow: visible;
    }

    .species-group.hidden {
      max-height: 0;
      opacity: 0;
      transform: translateY(-20px);
      margin-bottom: -18px;
      pointer-events: none;
      overflow: hidden;
    }

    .label {
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #fff;
    }

    .select, .input {
      height: 54px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      color: #fff;
      font-size: 18px;
      transition: all 0.3s;
    }

    .select {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 18px;
      cursor: pointer;
      position: relative;
    }

    .select-arrow { 
      width: 24px; height: 24px;
      filter: brightness(10) invert(1);
      transform: rotate(90deg);
      transition: transform 0.3s;
    }

    .select.open .select-arrow { transform: rotate(270deg); }

    .row { display: flex; gap: 10px; align-items: center; }

    .input { flex: 1; padding: 0 16px; outline: none; }
    .input::placeholder { color: var(--muted); }

    .input-result[readonly] {
      background: rgba(0, 0, 0, 0.4);
      color: var(--ai-accent); 
      cursor: not-allowed;
      border-style: dashed;
    }

    .unit {
      width: 50px; height: 54px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      border: 1px solid var(--glass-border);
    }

    .options {
      display: none;
      position: absolute;
      top: 60px; left: 0; width: 100%;
      background: #111;
      border-radius: 12px;
      padding: 8px;
      z-index: 100;
      list-style: none;
      border: 1px solid var(--glass-border);
    }

    .select.open .options { display: block; }
    .option { padding: 12px; border-radius: 8px; cursor: pointer; }
    .option:hover { background: rgba(255, 255, 255, 0.1); }

    .predict-btn {
      width: 100%;
      height: 40px;
      background: var(--brand-gradient);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 22px;
      font-family: 'Barriecito', cursive;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
    }

    .predict-btn:hover { opacity: 0.9; box-shadow: 0 0 15px rgba(255, 0, 255, 0.4); }
    .predict-btn:active { transform: scale(0.96); }

    /* ===== Toggle & Labels ===== */
    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 5px;
    }

    .model-label {
      font-family: 'ABeeZee', sans-serif; /* Même police que Résultat */
      font-size: 12px;
      text-transform: uppercase;
      color: var(--muted);
      flex: 1;
      text-align: center;
      letter-spacing: 0.5px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 52px; height: 26px;
      flex-shrink: 0;
    }

    .switch input { opacity: 0; width: 0; height: 0; }

    .slider {
      position: absolute; inset: 0;
      cursor: pointer;
      background: #444;
      border-radius: 26px;
      transition: .25s;
    }

    .slider:before {
      content: "";
      position: absolute; height: 20px; width: 20px;
      left: 3px; bottom: 3px;
      background: white;
      border-radius: 50%;
      transition: .25s;
    }

    .switch input:checked + .slider { background: var(--brand-gradient); }
    .switch input:checked + .slider:before { transform: translateX(26px); }

    @media (max-width: 600px) {
      .card { width: 90%; }
      .brand { font-size: 24px; letter-spacing: 5px; }
    }
  </style>
</head>

<body>
<main class="page">
  <h1 class="brand">C’est pas l’iris ?</h1>

  <section class="stage">
    <div class="image-wrap">
      <img class="iris" src="https://www.figma.com/api/mcp/asset/de819370-e81a-4496-9c3f-46d11bbef112" alt="iris" />
    </div>

    <form action="/predict" method="POST" class="card" id="predictForm">
      
      <div id="speciesContainer" class="species-group">
        <label class="label">Espèce de l'iris</label>
        <div class="select" id="speciesSelect" tabindex="0">
          <span class="select-value">Setosa</span>
          <img src="https://www.figma.com/api/mcp/asset/72e896e5-6e84-416e-865b-16fe20472ffe" class="select-arrow" />
          <input type="hidden" name="species" id="speciesHiddenInput" value="setosa">
          <ul class="options">
            <li class="option" data-value="setosa">Setosa</li>
            <li class="option" data-value="versicolor">Versicolor</li>
            <li class="option" data-value="virginica">Virginica</li>
          </ul>
        </div>
      </div>

      <label class="label">Largeur du sépale</label>
      <div class="row">
        <input type="number" step="0.1" name="sepal_width" class="input" placeholder="exemple 2.5" />
        <div class="unit">cm</div>
      </div>

      <label class="label">Choix du modèle</label>
      <div class="toggle-row">
        <span class="model-label">Modèle avec espèces</span>
        <label class="switch">
          <input type="checkbox" id="modelToggle">
          <span class="slider"></span>
        </label>
        <span class="model-label">Modèle sans espèces</span>
      </div>

      <input type="hidden" name="api_target" id="apiTarget" value="predict">
      <button type="submit" class="predict-btn">Prédire</button>

      <label class="label">Résultat</label>
      <div class="row">
        <input class="input input-result" placeholder="En attente..." value="{{ prediction_text if prediction_text else '' }}" readonly />
        <div class="unit">cm</div>
      </div>
    </form>
  </section>
</main>

<script>
/* =====================
   SELECT CUSTOM
===================== */
(function(){
  const select = document.getElementById('speciesSelect');
  if (!select) return;
  const valueEl = select.querySelector('.select-value');
  const hiddenInput = document.getElementById('speciesHiddenInput');
  const options = select.querySelectorAll('.option');

  select.addEventListener('click', (e) => {
    e.stopPropagation();
    select.classList.toggle('open');
  });

  options.forEach(opt => {
    opt.addEventListener('click', (e) => {
      e.stopPropagation();
      valueEl.textContent = opt.textContent.trim();
      hiddenInput.value = opt.dataset.value;
      select.classList.remove('open');
    });
  });

  document.addEventListener('click', (e)=>{
    if (!select.contains(e.target)) select.classList.remove('open');
  });
})();

/* =====================
   TOGGLE LOGIC & ANIMATION
===================== */
const toggle = document.getElementById("modelToggle");
const form = document.getElementById("predictForm");
const apiTarget = document.getElementById("apiTarget");
const speciesContainer = document.getElementById("speciesContainer");

toggle.addEventListener("change", () => {
  if (toggle.checked) {
    // Mode SANS espèces
    form.action = "/predict_alt";
    apiTarget.value = "predict_alt";
    speciesContainer.classList.add("hidden");
  } else {
    // Mode AVEC espèces
    form.action = "/predict";
    apiTarget.value = "predict";
    speciesContainer.classList.remove("hidden");
  }
});
</script>

</body>
</html>